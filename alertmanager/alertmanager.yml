global:
  resolve_timeout: 5m
  smtp_smarthost: smtp.example.com:587
  smtp_from: monitoring@example.com
  smtp_auth_username: monitoring@example.com
  smtp_auth_password: REPLACE_WITH_APP_PASSWORD
  slack_api_url: 

route:
  receiver: primary
  group_by: ['alertname', 'severity']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 3h
  routes:
    - receiver: slack_critical
      matchers:
        - severity="critical"
    - receiver: email_warnings
      matchers:
        - severity="warning"

receivers:
  - name: primary
    sns_configs:
      - topic_arn: arn:aws:sns:us-east-1:123456789012:rajo-alertmanager  # replace with terraform output
        sigv4:
          region: us-east-1
        subject: '[{{ .Status | toUpper }}][{{ .CommonLabels.severity | default "n/a" | toUpper }}] {{ .CommonAnnotations.summary }}'
        message: |
          Alertmanager notification:
          {{ range .Alerts -}}
          - Status: {{ .Status | toUpper }}
            Alert: {{ .Labels.alertname }}
            Instance: {{ .Labels.instance }}
            Summary: {{ .Annotations.summary }}
            Description: {{ .Annotations.description }}
          {{ end -}}
        send_resolved: true
    slack_configs:
      - channel: '#infra-alerts'
        username: Alertmanager
        send_resolved: true
        icon_emoji: ':satellite:'
        title: '[{{ .Status | toUpper }}] {{ .CommonAnnotations.summary }}'
        text: '{{ range .Alerts }}• {{ .Annotations.description }} ({{ .Labels.instance }}){{ "\\n" }}{{ end }}'
    email_configs:
      - to: 'noc@example.com'
        send_resolved: true
  - name: slack_critical
    slack_configs:
      - channel: '#infra-critical'
        username: Alertmanager
        send_resolved: true
        title: '[CRIT] {{ .CommonAnnotations.summary }}'
        text: '{{ range .Alerts }}• {{ .Annotations.description }}{{ "\\n" }}{{ end }}'
  - name: email_warnings
    email_configs:
      - to: 'oncall@example.com'
        send_resolved: true

inhibit_rules:
  - source_matchers:
      - severity="critical"
    target_matchers:
      - severity="warning"
    equal: ['alertname', 'instance']
  - source_matchers:
      - severity="warning"
    target_matchers:
      - severity="info"
    equal: ['alertname', 'instance']
